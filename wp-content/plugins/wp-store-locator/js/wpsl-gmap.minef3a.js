var wpsl=wpsl||{};function initWpslMap(){var e;e=setInterval(function(){"object"==typeof google&&"object"==typeof google.maps&&(clearInterval(e),jQuery(".wpsl-gmap-canvas").each(function(e){var t=jQuery(this).attr("id");wpsl.gmaps.init(t,e)}))},500)}wpsl.gmaps={},jQuery(document).ready(function(e){var t,s,o,n,i,a,l,r,c,p,d,m,u,w,f,g=[],h=[],v=[],$={},C={},y={},b=!1,L=!1,k="undefined"!=typeof wpslSettings?wpslSettings.autoLoad:"",x={},S={enabled:void 0!==wpslSettings.collectStatistics,addressComponents:""},I=void 0;function M(e,t){G(e,0,"",!0,t),V(e,b,k,t)}function E(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}function P(t,s){if(navigator.geolocation){var o,n,i=Number(wpslSettings.geoLocationTimeout);o=setInterval(function(){e(".wpsl-icon-direction").toggleClass("wpsl-active-icon")},600),n=setTimeout(function(){R(o),M(t,s)},i),navigator.geolocation.getCurrentPosition(function(i){R(o),clearTimeout(n),X(!1),z(t,i,b,s),e(".wpsl-search").addClass("wpsl-geolocation-run")},function(o){if(e(".wpsl-icon-direction").hasClass("wpsl-user-activated")&&!e(".wpsl-search").hasClass("wpsl-geolocation-run")){switch(o.code){case o.PERMISSION_DENIED:alert(wpslGeolocationErrors.denied);break;case o.POSITION_UNAVAILABLE:alert(wpslGeolocationErrors.unavailable);break;case o.TIMEOUT:alert(wpslGeolocationErrors.timeout);break;default:alert(wpslGeolocationErrors.generalError)}e(".wpsl-icon-direction").removeClass("wpsl-active-icon")}else e(".wpsl-search").hasClass("wpsl-geolocation-run")||(clearTimeout(n),M(t,s))},{maximumAge:6e4,timeout:i,enableHighAccuracy:!0})}else alert(wpslGeolocationErrors.unavailable),M(t,s)}function R(t){clearInterval(t),e(".wpsl-icon-direction").removeClass("wpsl-active-icon")}function z(e,t,s,o){if(void 0===t)M(e,o);else{var n=new google.maps.LatLng(t.coords.latitude,t.coords.longitude);x={position:t,newRequest:!0},l.setCenter(n),G(n,0,"",!0,o),V(n,s,k,o)}}function O(){void 0!==wpslSettings.infoWindowStyle&&"infobox"==wpslSettings.infoWindowStyle&&void 0!==g[0]&&g[0].close()}function T(){void 0!==w&&""!==w&&(w.setMap(null),w="")}function U(t){var s,o,n,i,a,p,d,m,f,g,v,$,y,b,L,k,x,S;for(O(),a=t.parents("li").length>0?t.parents("li").data("store-id"):t.parents(".wpsl-info-window").data("store-id"),void 0!==w&&""!==w&&(o=w.getPosition()),C={centerLatlng:l.getCenter(),zoomLevel:l.getZoom()},s=0,i=h.length;s<i;s++)0==h[s].storeId&&(void 0===o||""===o)?o=h[s].getPosition():h[s].storeId==a&&(n=h[s].getPosition());o&&n?(e("#wpsl-direction-details ul").empty(),e(".wpsl-direction-before, .wpsl-direction-after").remove(),p=o,d=n,S="",L="km"==wpslSettings.distanceUnit?"METRIC":"IMPERIAL",x={origin:p,destination:d,travelMode:wpslSettings.directionsTravelMode,unitSystem:google.maps.UnitSystem[L]},c.route(x,function(t,s){if(s==google.maps.DirectionsStatus.OK){if(r.setMap(l),r.setDirections(t),t.routes.length>0){for(y=0,$=t.routes[0];y<$.legs.length;y++)for(b=0,f=(m=$.legs[y]).steps.length;b<f;b++)g=m.steps[b],S=S+"<li><div class='wpsl-direction-index'>"+(v=b+1)+"</div><div class='wpsl-direction-txt'>"+g.instructions+"</div><div class='wpsl-direction-distance'>"+g.distance.text+"</div></li>";for(e("#wpsl-direction-details ul").append(S).before("<div class='wpsl-direction-before'><a class='wpsl-back' id='wpsl-direction-start' href='#'>"+wpslLabels.back+"</a><div><span class='wpsl-total-distance'>"+$.legs[0].distance.text+"</span> - <span class='wpsl-total-durations'>"+$.legs[0].duration.text+"</span></div></div>").after("<p class='wpsl-direction-after'>"+t.routes[0].copyrights+"</p>"),e("#wpsl-direction-details").show(),y=0,f=h.length;y<f;y++)h[y].setMap(null);u&&u.clearMarkers(),void 0!==w&&""!==w&&w.setMap(null),e("#wpsl-stores").hide(),1==wpslSettings.templateId&&(k=e("#wpsl-gmap").offset(),e(window).scrollTop(k.top))}}else(function e(t){var s;switch(t){case"NOT_FOUND":case"ZERO_RESULTS":s=wpslLabels.noDirectionsFound;break;case"OVER_QUERY_LIMIT":s=wpslLabels.queryLimit;break;default:s=wpslLabels.generalError}alert(s)})(s)})):alert(wpslLabels.generalError)}function Z(e,t){var s,o,n;for(s=0,o=h.length;s<o;s++)h[s].storeId==e&&(n=h[s],"start"==t?n.setAnimation(google.maps.Animation.BOUNCE):n.setAnimation(null))}function A(t){var s,o={};void 0===wpslSettings.geocodeComponents||e.isEmptyObject(wpslSettings.geocodeComponents)?o.address=e("#wpsl-search-input").val():(o.componentRestrictions=wpslSettings.geocodeComponents,void 0!==o.componentRestrictions.postalCode?o.componentRestrictions.postalCode=e("#wpsl-search-input").val():o.address=e("#wpsl-search-input").val()),a.geocode(o,function(e,o){o==google.maps.GeocoderStatus.OK?(S.enabled&&W(e),B(s=e[0].geometry.location,t)):ee(o)})}function B(e,t){G(e,0,"",!0,t),V(e,b,!1,t)}function j(t,s){var o,n=t.lat().toFixed(5),i=t.lng().toFixed(5);t.lat=function(){return parseFloat(n)},t.lng=function(){return parseFloat(i)},a.geocode({latLng:t},function(t,n){n==google.maps.GeocoderStatus.OK?(1==wpslSettings.autoLocate&&x.newRequest&&(""!==(o=function e(t){var s,o,n,i,a,l={},r=t.length;for(s=0;s<r;s++){for(o=0,i=t[s].address_components.length;o<i;o++){if(n=t[s].address_components[o].types,/^postal_code$/.test(n)||/^postal_code,postal_code_prefix$/.test(n)){l.zip=t[s].address_components[o].long_name;break}/^locality,political$/.test(n)&&(l.locality=t[s].address_components[o].long_name)}if(void 0!==l.zip)break}return void 0===l.zip&&void 0!==l.locality?l.locality:l.zip}(t))&&e("#wpsl-search-input").val(o),x.newRequest=!1),wpslSettings.directionRedirect&&(f=t[0].formatted_address),S.enabled&&e("#wpsl-search-input").val().length>0&&e.isEmptyObject(S.addressComponents)&&W(t),s()):ee(n)})}function W(t){var s,o,a,l,r,c,p,d,m={},u={};for(n=0,s="GB"==(l=(c=t,d="",e.each(c[0].address_components,function(e){if("country,political"==(p=c[0].address_components[e].types).join(","))return d=c[0].address_components[e].short_name,!1}),d))?{city:"postal_town",city_locality:"locality,political",region:"administrative_area_level_2,political",country:"administrative_area_level_1,political"}:{city:"locality,political",region:"administrative_area_level_1,political",country:"country,political"},o=t[0].address_components.length;n<o;n++)for(var w in a=t[0].address_components[n].types,s)s[w]==a.join(",")&&(t[0].address_components[n].long_name.length>0?u[w]=t[0].address_components[n].long_name:u[w]=t[0].address_components[n].short_name);for(var w in s)void 0===u[w]&&(m[w]=s[w]);if("GB"==l&&void 0!==m.city_locality&&void 0===m.city&&(m={}),Object.keys(m).length>0)for(n=1,r=t.length;n<r;n++)for(i=0,o=t[n].address_components.length;i<o;i++)for(var w in a=t[n].address_components[i].types,m)s[w]==a.join(",")&&(u[w]=t[n].address_components[i].long_name);void 0!==u.city_locality&&u.city_locality.length>0&&(u.city=u.city_locality,delete u.city_locality),S.addressComponents=u}function V(e,t,s,o){1==wpslSettings.directionRedirect||S.enabled?j(e,function(){H(e,t,s,o)}):H(e,t,s,o)}function D(){var t;let s=e("#wpsl-filters"),o=[];s.find(".jsWpslFilterItem").each(function(){let t=e(this),s=t.data("term-id").toString();t.hasClass("isActive")?s.includes(",")?s.split(",").forEach(e=>!o.includes(e)&&o.push(e)):o.includes(s)||o.push(s):s.includes(",")||o.forEach((e,t)=>{e===s&&o.splice(t,1)})}),t=o,wpslSettings&&Array.isArray(t)&&t.length?(void 0===wpslSettings.categoryIds&&(wpslSettings.categoryIds=""),F(t),wpslSettings.categoryIds=t.join(",")):(F(!1),wpslSettings.categoryIds=void 0)}function F(t){e("#wpsl-checkbox-filter").find("input").each(function(){let s=e(this);s.prop("checked",!!t&&t.includes(s.val()))})}function H(t,s,o,n){var i,a,r,c,p,d,m,u,w,f,g,v,$,C,b,L,k="",I=e("#wpsl-listing-template").html(),M=e("#wpsl-stores ul"),P=wpslSettings.url+"img/ajax-loader.gif";r=(c=t,p=s,d=o,v="",$=e("#wpsl-wrap").hasClass("wpsl-mobile"),C=e("#wpsl-wrap").hasClass("wpsl-default-filters"),b={action:"store_search",lat:c.lat(),lng:c.lng()},p?(b.max_results=wpslSettings.maxResults,b.search_radius=wpslSettings.searchRadius):($||C?(m=parseInt(e("#wpsl-results .wpsl-dropdown").val()),u=parseInt(e("#wpsl-radius .wpsl-dropdown").val())):(m=parseInt(e("#wpsl-results .wpsl-selected-item").attr("data-value")),u=parseInt(e("#wpsl-radius .wpsl-selected-item").attr("data-value"))),isNaN(m)?b.max_results=wpslSettings.maxResults:b.max_results=m,isNaN(u)?b.search_radius=wpslSettings.searchRadius:b.search_radius=u,void 0!==wpslSettings.categoryIds?b.filter=wpslSettings.categoryIds:e("#wpsl-category").length>0?isNaN(v=$||C?parseInt(e("#wpsl-category .wpsl-dropdown").val()):parseInt(e("#wpsl-category .wpsl-selected-item").attr("data-value")))||0===v||(b.filter=v):e("#wpsl-checkbox-filter").length>0&&e("#wpsl-checkbox-filter input:checked").length>0&&(b.filter=(L=e("#wpsl-checkbox-filter input:checked").map(function(){return e(this).val()}),(L=L.get()).join(","))),e(".wpsl-custom-dropdown").length>0&&!e("#wpsl-filters")&&e(".wpsl-custom-dropdown").each(function(t){w="",f="",$||C?(w=e(this).attr("name"),f=e(this).val()):(w=e(this).attr("name"),f=e(this).next(".wpsl-selected-item").attr("data-value")),w&&f&&(b[w]=f)}),e(".wpsl-custom-checkboxes").length>0&&e(".wpsl-custom-checkboxes").each(function(t){var s,o,n;(g=e(this).attr("data-name"))&&(b[g]=(s=g,o=e("[data-name="+s+"]"),n=[],e(o).find("input:checked").each(function(t){n.push(e(this).val())}),n.join()))})),1==d&&(void 0!==x.position?b.skip_cache=1:(b.autoload=1,void 0!==wpslSettings.categoryIds&&(b.filter=wpslSettings.categoryIds))),S.enabled&&0==d&&(b.search=e("#wpsl-search-input").val(),b.statistics=S.addressComponents),b),M.empty().append("<li class='wpsl-preloader'><img src='"+P+"'/>"+wpslLabels.preloader+"</li>"),e("#wpsl-wrap").removeClass("wpsl-no-results"),e.get(wpslSettings.ajaxurl,r,function(s){var o;e(".wpsl-preloader").remove(),s.length>0&&void 0===s.addon?(e.each(s,function(e){_.extend(s[e],Q),G(i=new google.maps.LatLng(s[e].lat,s[e].lng),s[e].id,s[e],!1,n),k+=_.template(I)(s[e])}),e("#wpsl-result-list").off("click",".wpsl-directions"),M.empty(),M.append(k),e("#wpsl-result-list").on("click",".wpsl-directions",function(){if(1!=wpslSettings.directionRedirect)return U(e(this)),!1}),N(),e("#wpsl-result-list p:empty").remove()):(G(t,0,"",!0,n),a=void 0!==wpslSettings.noResults&&""!==wpslSettings.noResults?wpslSettings.noResults:wpslLabels.noResults,e("#wpsl-wrap").addClass("wpsl-no-results"),M.html("<li class='wpsl-no-results-msg'>"+a+"</li>")),1==wpslSettings.runFitBounds?J():(l.setZoom(Number(wpslSettings.zoomLevel)),l.setCenter(h[0].position)),1==wpslSettings.resetMap&&(e.isEmptyObject(y)&&google.maps.event.addListenerOnce(l,"tilesloaded",function(){y={centerLatlng:l.getCenter(),zoomLevel:l.getZoom()},e("#wpsl-map-controls").addClass("wpsl-reset-exists"),e(".wpsl-icon-reset, #wpsl-reset-map").show()}),e(".wpsl-icon-reset").removeClass("wpsl-in-progress"))}),1!=wpslSettings.mouseFocus||E()||e("#wpsl-search-input").focus()}function N(){if(1==wpslSettings.markerClusters){var e,t,s=Number(wpslSettings.clusterZoom),o=Number(wpslSettings.clusterSize);isNaN(s)&&(s=""),isNaN(o)&&(o=""),void 0!==wpslSettings.excludeStartFromCluster&&1==wpslSettings.excludeStartFromCluster&&(t=h.slice(0)).splice(0,1),e=void 0===t?h:t,u=new MarkerClusterer(l,e,{gridSize:o,maxZoom:s})}}function G(t,s,o,n,i){var a,r,c,p;0===s?(o={store:wpslLabels.startPoint},a=$.url+wpslSettings.startMarker):a=void 0!==o.alternateMarkerUrl&&o.alternateMarkerUrl?o.alternateMarkerUrl:void 0!==o.categoryMarkerUrl&&o.categoryMarkerUrl?o.categoryMarkerUrl:$.url+wpslSettings.storeMarker,r={url:a,scaledSize:new google.maps.Size(Number($.scaledSize[0]),Number($.scaledSize[1])),origin:new google.maps.Point(Number($.origin[0]),Number($.origin[1])),anchor:new google.maps.Point(Number($.anchor[0]),Number($.anchor[1]))},c=new google.maps.Marker({position:t,map:l,optimized:!1,title:function e(t){if(t)return t.replace(/&#(\d+);/g,function(e,t){return String.fromCharCode(t)})}(o.store),draggable:n,storeId:s,icon:r}),h.push(c),google.maps.event.addListener(c,"click",(p=l,function(){var n,a;c.setIcon({url:$.url+"marker-shadow.png",scaledSize:new google.maps.Size(59,59),anchor:new google.maps.Point(15,59)}),void 0!==I&&I.setIcon({url:$.url+wpslSettings.storeMarker,scaledSize:new google.maps.Size(40,40),anchor:new google.maps.Point(10,40)}),I=c,0!=s?void 0!==wpslSettings.markerStreetView&&1==wpslSettings.markerStreetView?(n=t,a=function(){q(c,Y(o),i,p)},new google.maps.StreetViewService().getPanoramaByLocation(n,50,function(e,t){L=t==google.maps.StreetViewStatus.OK,a()})):q(c,Y(o),i,p):q(c,wpslLabels.startPoint,i,p),google.maps.event.clearListeners(i,"domready"),google.maps.event.addListener(i,"domready",function(){var t,s;t=c,s=p,e(".wpsl-info-actions a").on("click",function(o){var n,i,a,l,r,c=Number(wpslSettings.autoZoomLevel);if(o.stopImmediatePropagation(),e(this).hasClass("wpsl-directions")){if(1==wpslSettings.directionRedirect)return!0;U(e(this))}else{e(this).hasClass("wpsl-streetview")?(n=t,i=s,a=i.getStreetView(),a.setPosition(n.getPosition()),a.setVisible(!0),e("#wpsl-map-controls").hide(),l=a,r=i,google.maps.event.addListener(l,"visible_changed",function(){if(!l.getVisible()){var t=r.getZoom();e("#wpsl-map-controls").show(),r.setZoom(t-1),r.setZoom(t)}})):e(this).hasClass("wpsl-zoom-here")&&(s.setCenter(t.getPosition()),s.setZoom(c))}return!1}),K()})})),n&&google.maps.event.addListener(c,"dragend",function(e){X(!0),l.setCenter(e.latLng),j(e.latLng),V(e.latLng,b,k=!1,i)})}function q(e,t,s,o){g.length=0,s.setContent(t),s.open(o,e),g.push(s),void 0!==wpslSettings.infoWindowStyle&&"infobox"==wpslSettings.infoWindowStyle&&1==wpslSettings.markerClusters&&(d=e.storeId,s.setVisible(!0))}function K(){l.getZoom()>=wpslSettings.autoZoomLevel?e(".wpsl-zoom-here").hide():e(".wpsl-zoom-here").show()}_.templateSettings={evaluate:/\<\%(.+?)\%\>/g,interpolate:/\<\%=(.+?)\%\>/g,escape:/\<\%-(.+?)\%\>/g},wpsl.gmaps.init=function(t,s,o){var n,i,d,w,f,g,h,C,b,L,S,I,R,O,U,Z,j,W,V,F=Number(wpslSettings.zoomLevel),H=Number(wpslSettings.autoZoomLevel);(C=Number((d=function e(t){var s,o,n,i,a,l,r,c=["zoomLevel","mapType","mapTypeControl","mapStyle","streetView","scrollWheel","controlPosition"],p={zoomLevel:wpslSettings.zoomLevel,mapType:wpslSettings.mapType,mapTypeControl:wpslSettings.mapTypeControl,mapStyle:wpslSettings.mapStyle,streetView:wpslSettings.streetView,scrollWheel:wpslSettings.scrollWheel,controlPosition:wpslSettings.controlPosition,gestureHandling:wpslSettings.gestureHandling};if(void 0!==window["wpslMap_"+t]&&void 0!==window["wpslMap_"+t].shortCode)for(a=0,l=c.length;a<l;a++)void 0!==(r=window["wpslMap_"+t].shortCode[c[a]])&&(p[c[a]]=r);return p.startLatLng=(s=t,i="",void 0!==window["wpslMap_"+s]&&void 0!==window["wpslMap_"+s].locations&&(i=window["wpslMap_"+s].locations[0]),void 0!==i&&void 0!==i.lat&&void 0!==i.lng?o=new google.maps.LatLng(i.lat,i.lng):""!==wpslSettings.startLatlng?(n=wpslSettings.startLatlng.split(","),o=new google.maps.LatLng(n[0],n[1])):o=new google.maps.LatLng(0,0),o),p}(s)).zoomLevel))!==F&&(H=C),w=(S={},void 0!==wpslSettings.infoWindowStyle&&"infobox"==wpslSettings.infoWindowStyle?(b=wpslSettings.infoBoxClearance.split(","),L=wpslSettings.infoBoxPixelOffset.split(","),S={alignBottom:!0,boxClass:wpslSettings.infoBoxClass,closeBoxMargin:wpslSettings.infoBoxCloseMargin,closeBoxURL:wpslSettings.infoBoxCloseUrl,content:"",disableAutoPan:!!Number(wpslSettings.infoBoxDisableAutoPan),enableEventPropagation:!!Number(wpslSettings.infoBoxEnableEventPropagation),infoBoxClearance:new google.maps.Size(Number(b[0]),Number(b[1])),pixelOffset:new google.maps.Size(Number(L[0]),Number(L[1])),zIndex:Number(wpslSettings.infoBoxZindex)},m=new InfoBox(S)):m=new google.maps.InfoWindow,m),a=new google.maps.Geocoder,r=new google.maps.DirectionsRenderer,c=new google.maps.DirectionsService,n={zoom:C,center:d.startLatLng,mapTypeId:google.maps.MapTypeId[d.mapType.toUpperCase()],mapTypeControl:!!Number(d.mapTypeControl),streetViewControl:!!Number(d.streetView),gestureHandling:d.gestureHandling,disableDefaultUI:!!o,zoomControlOptions:{position:google.maps.ControlPosition[d.controlPosition.toUpperCase()+"_TOP"]}},"cooperative"!==d.gestureHandling&&(n.scrollwheel=!!Number(d.scrollWheel)),$=function e(){var t,s=wpslSettings.markerIconProps,o={};for(var n in void 0!==s.url?o.url=s.url:void 0!==s.categoryMarkerUrl?o.categoryMarkerUrl=s.categoryMarkerUrl:void 0!==s.alternateMarkerUrl?o.alternateMarkerUrl=s.alternateMarkerUrl:o.url=wpslSettings.url+"img/markers/",s)s.hasOwnProperty(n)&&2==(t=s[n].split(",")).length&&(o[n]=t);return o}(),l=new google.maps.Map(document.getElementById(t),n),(I=function e(t){try{var s=JSON.parse(t);if(s&&"object"==typeof s&&null!==s)return s}catch(o){}return!1}(I=d.mapStyle))&&l.setOptions({styles:I}),void 0!==window["wpslMap_"+s]&&void 0!==window["wpslMap_"+s].locations&&(g=new google.maps.LatLngBounds,h=window["wpslMap_"+s].locations,e.each(h,function(e){G(f=new google.maps.LatLng(h[e].lat,h[e].lng),h[e].id,h[e],!1,w),g.extend(f)}),h.length>1&&(eo(l,H),l.fitBounds(g)),_.isArray(wpslSettings.mapTabAnchor)&&(i={map:l,bounds:g,maxZoom:H},v.push(i))),e("#wpsl-gmap").length&&(1==wpslSettings.autoComplete&&function t(){var s,o,n,i={};if(e("#wpsl-search-input").keypress(function(e){if(13==e.which)return en(),A(m),!1}),void 0===wpslSettings.geocodeComponents||e.isEmptyObject(wpslSettings.geocodeComponents)||(i.componentRestrictions=wpslSettings.geocodeComponents,i.componentRestrictions=_.omit(i.componentRestrictions,"postalCode")),void 0!==wpslSettings.autoCompleteOptions&&!e.isEmptyObject(wpslSettings.autoCompleteOptions))for(var a in wpslSettings.autoCompleteOptions)wpslSettings.autoCompleteOptions.hasOwnProperty(a)&&(i[a]=wpslSettings.autoCompleteOptions[a]);s=document.getElementById("wpsl-search-input"),(o=new google.maps.places.Autocomplete(s,i)).addListener("place_changed",function(){(n=o.getPlace()).geometry&&(p=n.geometry.location)})}(),!E()&&e(".wpsl-dropdown").length&&1==wpslSettings.enableStyledDropdowns?(R=Number(wpslSettings.maxDropdownHeight),e(".wpsl-dropdown").each(function(t){var s,o,n=e(this);n.$dropdownWrap=n.wrap("<div class='wpsl-dropdown'></div>").parent(),n.$selectedVal=n.val(),n.$dropdownElem=e("<div><ul/></div>").appendTo(n.$dropdownWrap),n.$dropdown=n.$dropdownElem.find("ul"),n.$options=n.$dropdownWrap.find("option"),n.hide().removeClass("wpsl-dropdown"),e.each(n.$options,function(){s=e(this).val()==n.$selectedVal?'class="wpsl-selected-dropdown"':"",n.$dropdown.append("<li data-value="+e(this).val()+" "+s+">"+e(this).text()+"</li>")}),n.$dropdownElem.before("<span data-value="+n.find(":selected").val()+" class='wpsl-selected-item'>"+n.find(":selected").text()+"</span>"),n.$dropdownItem=n.$dropdownElem.find("li"),n.$dropdownWrap.on("click",function(t){if(e(this).hasClass("wpsl-active")){e(this).removeClass("wpsl-active");return}et(),e(this).toggleClass("wpsl-active"),o=0,e(this).hasClass("wpsl-active")?(n.$dropdownItem.each(function(t){o+=e(this).outerHeight()}),n.$dropdownElem.css("height",o+2+"px")):n.$dropdownElem.css("height",0),o>R&&(e(this).addClass("wpsl-scroll-required"),n.$dropdownElem.css("height",R+"px")),t.stopPropagation()}),n.$dropdownItem.on("click",function(t){n.$dropdownWrap.find(e(".wpsl-selected-item")).html(e(this).text()).attr("data-value",e(this).attr("data-value")),n.$dropdownItem.removeClass("wpsl-selected-dropdown"),e(this).addClass("wpsl-selected-dropdown"),et(),t.stopPropagation()})}),e(document).click(function(){et()})):(e("#wpsl-search-wrap select").show(),E()?e("#wpsl-wrap").addClass("wpsl-mobile"):e("#wpsl-wrap").addClass("wpsl-default-filters")),e(".wpsl-search").hasClass("wpsl-widget")||(1==wpslSettings.autoLocate?P(d.startLatLng,w):1==wpslSettings.autoLoad&&M(d.startLatLng,w)),1!=wpslSettings.mouseFocus||E()||e("#wpsl-search-input").focus(),O=w,e("#wpsl-search-btn").unbind("click").bind("click",function(t){return e("#wpsl-search-input").removeClass(),e("#wpsl-search-input").val()?(en(),1==wpslSettings.autoComplete&&void 0!==p?B(p,O):A(O)):e("#wpsl-search-input").addClass("wpsl-error").focus(),!1}),U=d,Z=w,e(document).on("click",".jsWpslFilterItem",function(t){t.preventDefault();let s=e(this),o=s.parents(".jsSelect");if(s.hasClass("isActive"))return!1;s.addClass("isActive"),o.find(".jsWpslFilterItem").not(s).removeClass("isActive"),o.addClass("isSelected").find(".eHSelect_text").text(s.text()),o.find(".eHSelect_ico").addClass("jsClearFilterGroup"),D(),en(),1==wpslSettings.autoComplete&&void 0!==p?B(p,Z):M(U.startLatLng,Z)}),e(document).on("click",".jsClearFilterGroup",function(t){let s=e(this),o=s.parents(".jsSelect");s.removeClass("jsClearFilterGroup"),o.removeClass("isSelected").find(".jsWpslFilterItem").removeClass("isActive"),o.find(".eHSelect_text").text(o.find(".eHSelect_text").data("default-name")),D(),en(),1==wpslSettings.autoComplete&&void 0!==p?B(p,Z):M(U.startLatLng,Z)}),j=d,W=l,V=w,google.maps.event.addListenerOnce(W,"tilesloaded",function(){var t,s;e(".gm-style").append(wpslSettings.mapControls),e(".wpsl-icon-reset, #wpsl-reset-map").length>0&&(t=j.startLatLng,s=V,e(".wpsl-icon-reset, #wpsl-reset-map").on("click",function(){!e(this).hasClass("wpsl-in-progress")&&(1==wpslSettings.autoLoad&&(k=1),(l.getCenter().lat()!==y.centerLatlng.lat()||l.getCenter().lng()!==y.centerLatlng.lng()||l.getZoom()!==y.zoomLevel)&&(X(!1),e("#wpsl-search-input").val("").removeClass(),e(".wpsl-icon-reset").addClass("wpsl-in-progress"),u&&u.clearMarkers(),T(),function t(){var s,o,n,i,a,l,r,c,p=e("#wpsl-wrap").hasClass("wpsl-default-filters"),d=[wpslSettings.searchRadius+" "+wpslSettings.distanceUnit,wpslSettings.maxResults],m=["wpsl-radius","wpsl-results"];for(s=0,o=m.length;s<o;s++)e("#"+m[s]+" select").val(parseInt(d[s])),e("#"+m[s]+" li").removeClass(),"wpsl-radius"==m[s]?n=wpslSettings.searchRadius:"wpsl-results"==m[s]&&(n=wpslSettings.maxResults),e("#"+m[s]+" li").each(function(){e(this).text()===d[s]&&(e(this).addClass("wpsl-selected-dropdown"),e("#"+m[s]+" .wpsl-selected-item").html(d[s]).attr("data-value",n))});e("#wpsl-category").length&&(e("#wpsl-category select").val(0),e("#wpsl-category li").removeClass(),e("#wpsl-category li:first-child").addClass("wpsl-selected-dropdown"),i=e("#wpsl-category li:first-child").text(),e("#wpsl-category .wpsl-selected-item").html(i).attr("data-value",0)),e(".wpsl-custom-dropdown").length>0&&e(".wpsl-custom-dropdown").each(function(t){p?e(this).find("option").removeAttr("selected"):(r=(l=(a=e(this).siblings("div")).find("li:first-child")).text(),c=l.attr("data-value"),a.find("li").removeClass(),a.prev().html(r).attr("data-value",c))})}(),1==wpslSettings.autoLocate?z(t,x.position,!0,s):M(t,s)),e("#wpsl-stores").show(),e("#wpsl-direction-details").hide())}),e(".wpsl-icon-reset").hide()),e(".wpsl-icon-direction").on("click",function(){e(this).addClass("wpsl-user-activated"),P(j.startLatLng,V)})}),e(".wpsl-search").hasClass("wpsl-widget")&&(e("#wpsl-search-btn").trigger("click"),e(".wpsl-search").removeClass("wpsl-widget"))),void 0!==wpslSettings.markerZoomTo&&1==wpslSettings.markerZoomTo&&google.maps.event.addListener(l,"zoom_changed",function(){K()})},e(".wpsl-gmap-canvas").length&&(e("<img />").attr("src",wpslSettings.url+"img/ajax-loader.gif"),e(".wpsl-gmap-canvas").each(function(t){var s=e(this).attr("id"),o=!1;e(".eWPSLSingle_map").length&&(wpslSettings.storeMarker="marker-shadow@2x.png",wpslSettings.markerIconProps.scaledSize="59,59",wpslSettings.markerIconProps.anchor="15,59",o=!0),wpsl.gmaps.init(s,t,o)}),function t(){var s,o;if(_.isArray(wpslSettings.mapTabAnchor))for(s=0,o=v.length;s<o;s++)es(v[s],wpslSettings.mapTabAnchor[s],s);else e("a[href='#"+wpslSettings.mapTabAnchor+"']").length&&es(l,wpslSettings.mapTabAnchor)}()),e("#wpsl-result-list").on("click",".wpsl-back",function(){var t,s;for(r.setMap(null),t=0,s=h.length;t<s;t++)h[t].setMap(l);return void 0!==w&&""!==w&&w.setMap(l),u&&N(),l.setCenter(C.centerLatlng),l.setZoom(C.zoomLevel),e(".wpsl-direction-before, .wpsl-direction-after").remove(),e("#wpsl-stores").show(),e("#wpsl-direction-details").hide(),!1}),e("#wpsl-gmap").length&&("bounce"==wpslSettings.markerEffect?(e("#wpsl-stores").on("mouseenter","li",function(){Z(e(this).data("store-id"),"start")}),e("#wpsl-stores").on("mouseleave","li",function(){Z(e(this).data("store-id"),"stop")})):"info_window"==wpslSettings.markerEffect&&e("#wpsl-stores").on("mouseenter","li",function(){var t,s;for(t=0,s=h.length;t<s;t++)h[t].storeId==e(this).data("store-id")&&(google.maps.event.trigger(h[t],"click"),l.setCenter(h[t].position))})),void 0!==wpslSettings.infoWindowStyle&&"infobox"==wpslSettings.infoWindowStyle&&1==wpslSettings.markerClusters&&google.maps.event.addListener(l,"zoom_changed",function(){google.maps.event.addListenerOnce(l,"idle",function(){if(void 0!==u&&(t=u.clusters_).length){for(n=0,s=t.length;n<s;n++)for(i=0,o=t[n].markers_.length;i<o;i++)if(t[n].markers_[i].storeId==d){m.getVisible()&&null===t[n].markers_[i].map?m.setVisible(!1):m.getVisible()||null===t[n].markers_[i].map||m.setVisible(!0);break}}})});var Q={formatPhoneNumber:function(e){return(1==wpslSettings.phoneUrl&&E()||1==wpslSettings.clickableDetails)&&(e="<a href='tel:"+Q.formatClickablePhoneNumber(e)+"'>"+e+"</a>"),e},formatClickablePhoneNumber:function(e){return -1!=e.indexOf("+")&&-1!=e.indexOf("(0)")&&(e=e.replace("(0)","")),e.replace(/(-| |\(|\)|\.|)/g,"")},formatEmail:function(e){return 1==wpslSettings.clickableDetails&&(e="<a href='mailto:"+e+"'>"+e+"</a>"),e},createInfoWindowActions:function(t){var s,o="",n="";return e("#wpsl-gmap").length&&(L&&(o="<a class='wpsl-streetview' href='#'>"+wpslLabels.streetView+"</a>"),1==wpslSettings.markerZoomTo&&(n="<a class='wpsl-zoom-here' href='#'>"+wpslLabels.zoomHere+"</a>"),s="<div class='wpsl-info-actions'>"+Q.createDirectionUrl(t)+o+n+"</div>"),s},createDirectionUrl:function(t){var s,o,n,i={};return 1==wpslSettings.directionRedirect?(void 0===f&&(f=""),i.target="target='_blank'",void 0!==t?i.src=e("[data-store-id="+t+"] .wpsl-directions").attr("href"):(n=this.zip?this.zip+", ":"",o=this.address+", "+this.city+", "+n+this.country,i.src="https://www.google.com/maps/dir/?api=1&origin="+Q.rfc3986EncodeURIComponent(f)+"&destination="+Q.rfc3986EncodeURIComponent(o)+"&travelmode="+wpslSettings.directionsTravelMode.toLowerCase())):i={src:"#",target:""},s="<a class='wpsl-directions' "+i.target+" href='"+i.src+"'>"+wpslLabels.directions+"</a>"},rfc3986EncodeURIComponent:function(e){return encodeURIComponent(e).replace(/[!'()*]/g,escape)}};function Y(t){var s,o;return o=e("#wpsl-base-gmap_0").length?e("#wpsl-cpt-info-window-template").html():e("#wpsl-info-window-template").html(),s=_.template(o)(t)}function J(){var e,t,s,o=Number(wpslSettings.autoZoomLevel),n=new google.maps.LatLngBounds;for(eo(l,o),t=0,s=h.length;t<s;t++)n.extend(h[t].position);l.fitBounds(n),l.setCenter(h[0].position);var i=!1;function a(){i?l.setZoom(l.getZoom()+3):l.setZoom(l.getZoom()+1)}navigator.geolocation?e=setTimeout(function(){navigator.geolocation.getCurrentPosition(function e(){i=!0,a()},function e(){i=!1,a()})},3e3):a()}function X(e){var t,s;if(r.setMap(null),h){for(s=0,t=h.length;s<t;s++)e?!0!=h[s].draggable?h[s].setMap(null):w=h[s]:h[s].setMap(null);h.length=0}u&&u.clearMarkers()}function ee(e){var t;switch(e){case"ZERO_RESULTS":t=wpslLabels.noResults;break;case"OVER_QUERY_LIMIT":t=wpslLabels.queryLimit;break;default:t=wpslLabels.generalError}alert(t)}function et(){e(".wpsl-dropdown").removeClass("wpsl-active"),e(".wpsl-dropdown div").css("height",0)}function es(t,s,o){var n,i,a,l,r,c=!!Number(wpslSettings.mapTabAnchorReturn),p=e("a[href='#"+s+"']");a=void 0!==t.maxZoom?t.maxZoom:Number(wpslSettings.autoZoomLevel),void 0!==o&&0==o&&p.addClass("wpsl-fitbounds"),p.on("click",function(){return setTimeout(function(){void 0!==t.map?(l=t.bounds,r=t.map):r=t,n=r.getZoom(),i=r.getCenter(),google.maps.event.trigger(r,"resize"),p.hasClass("wpsl-fitbounds")||(eo(r,a),r.setZoom(n),r.setCenter(i),void 0!==l?r.fitBounds(l):J(),p.addClass("wpsl-fitbounds"))},50),c})}function eo(e,t){google.maps.event.addListenerOnce(e,"bounds_changed",function(){google.maps.event.addListenerOnce(e,"idle",function(){this.getZoom()>t&&this.setZoom(t)})})}function en(){e("#wpsl-result-list ul").empty(),e("#wpsl-stores").show(),e(".wpsl-direction-before, .wpsl-direction-after").remove(),e("#wpsl-direction-details").hide(),b=!1,O(),X(!1),T()}e("#wpsl-stores").on("click",".wpsl-store-details",function(){var t,s,o=e(this).parents("li"),n=o.data("store-id");if("info window"==wpslSettings.moreInfoLocation)for(t=0,s=h.length;t<s;t++)h[t].storeId==n&&google.maps.event.trigger(h[t],"click");else o.find(".wpsl-more-info-listings").is(":visible")?e(this).removeClass("wpsl-active-details"):e(this).addClass("wpsl-active-details"),o.siblings().find(".wpsl-store-details").removeClass("wpsl-active-details"),o.siblings().find(".wpsl-more-info-listings").hide(),o.find(".wpsl-more-info-listings").toggle();if("default"!=wpslSettings.templateId||"store listings"==wpslSettings.moreInfoLocation)return!1})});